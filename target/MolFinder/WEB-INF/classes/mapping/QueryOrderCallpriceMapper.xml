<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.mol.dao.QueryOrderCallpriceMapper" >
  <select id="listCallpriceQueryOrdersWithStatus" resultType="com.mol.dto.QueryOrderCallpriceDTO">
    select a.query_call_id, a.query_order_id, a.call_price_money, a.call_submit_deadline, a.prepayed_money_amount, a.vilation_money_amount,a.create_time, a.state,c.company_name,b.cas_no,b.user_id, b.image
    from t_query_order_callprice a, t_query_order b, t_certification c
    <where>
      <choose>
        <when test="status == 'SENDED'">
          a.state = 'HERE'or a.state = 'OTHER'
        </when>
        <when test="status == 'CANCEL'">
          a.state = 'CANCEL'or a.state = 'BUYER_CANCEL'
        </when>
        <otherwise>
          a.state = #{status}
        </otherwise>
      </choose>
      and a.user_id = #{userId} and b.user_id = c.user_id and a.query_order_id = b.query_order_id
      <if test="searchKey != null and searchKey != '' ">
        and (b.cas_no like CONCAT('%', #{searchKey, jdbcType=VARCHAR}, '%'))
      </if>
    </where>
    order by
    a.query_call_id asc
    <if test="orderColumn != null and orderColumn !='' and orderType != null and orderType != '' ">
      , ${orderColumn} ${orderType}
    </if>
  </select>
</mapper>